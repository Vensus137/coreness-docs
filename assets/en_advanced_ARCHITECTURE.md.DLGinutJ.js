import{_ as n,o as s,c as t,af as i}from"./chunks/framework.DZTH9Z-c.js";const g=JSON.parse('{"title":"Platform Architecture","description":"Detailed Coreness architecture description. Event-driven system, plugins, DI container, multitenancy and project structure.","frontmatter":{"title":"Platform Architecture","description":"Detailed Coreness architecture description. Event-driven system, plugins, DI container, multitenancy and project structure.","keywords":"coreness architecture, event-driven, dependency injection, plugins, multitenancy","head":[["meta",{"property":"og:title","content":"Platform Architecture | Coreness"}],["meta",{"property":"og:description","content":"Detailed Coreness architecture description. Event-driven system, plugins, DI container, multitenancy and project structure."}],["meta",{"property":"og:image","content":"https://docs.coreness.tech/logo-dark.png"}],["meta",{"property":"og:url","content":"https://docs.coreness.tech/en/advanced/ARCHITECTURE"}],["link",{"rel":"canonical","href":"https://docs.coreness.tech/en/advanced/ARCHITECTURE"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"TechArticle\\",\\"headline\\":\\"Platform Architecture\\",\\"description\\":\\"Detailed Coreness architecture description. Event-driven system, plugins, DI container, multitenancy and project structure.\\",\\"url\\":\\"https://docs.coreness.tech/en/advanced/ARCHITECTURE\\"}"]]},"headers":[],"relativePath":"en/advanced/ARCHITECTURE.md","filePath":"en/advanced/ARCHITECTURE.md"}'),a={name:"en/advanced/ARCHITECTURE.md"};function r(o,e,l,c,p,d){return s(),t("div",null,[...e[0]||(e[0]=[i(`<h1 id="project-architecture" tabindex="-1">Project Architecture <a class="header-anchor" href="#project-architecture" aria-label="Permalink to &quot;Project Architecture&quot;">â€‹</a></h1><h2 id="âš ï¸-system-requirements" tabindex="-1">âš ï¸ System Requirements <a class="header-anchor" href="#âš ï¸-system-requirements" aria-label="Permalink to &quot;âš ï¸ System Requirements&quot;">â€‹</a></h2><h3 id="python-version" tabindex="-1">Python Version <a class="header-anchor" href="#python-version" aria-label="Permalink to &quot;Python Version&quot;">â€‹</a></h3><ul><li><strong>âœ… Recommended:</strong> Python 3.11</li><li><strong>âŒ Not recommended:</strong> Python 3.12+ (may work incorrectly or not work at all)</li><li><strong>â„¹ï¸ Reason:</strong> Dependencies on specific library and API versions</li></ul><h2 id="libraries-used" tabindex="-1">Libraries Used <a class="header-anchor" href="#libraries-used" aria-label="Permalink to &quot;Libraries Used&quot;">â€‹</a></h2><ul><li><strong>SQLAlchemy</strong> â€” ORM for database operations</li><li><strong>PyYAML</strong> â€” YAML config parsing</li><li><strong>psycopg2-binary</strong> â€” PostgreSQL connection driver</li><li><strong>python-dotenv</strong> â€” environment variable loading</li><li><strong>unidecode</strong> â€” transliteration</li><li><strong>emoji</strong> â€” emoji support</li><li><strong>requests</strong> â€” HTTP client for external API requests (tools, dev)</li><li><strong>aiohttp</strong> â€” asynchronous HTTP client for Telegram Bot API</li><li><strong>openai</strong> â€” library for OpenAI API via OpenRouter</li><li><strong>gitpython</strong> â€” Git repository operations (deployment, updates)</li><li><strong>telegramify-markdown</strong> â€” Markdown to Telegram MarkdownV2 format conversion</li><li><strong>croniter</strong> â€” cron expression parsing for scheduled scenarios</li><li><strong>pydantic</strong> â€” data validation against config.yaml schemas</li><li><strong>cryptography</strong> â€” self-signed SSL certificate generation for Telegram webhooks</li><li><strong>pgvector</strong> â€” vector data operations in PostgreSQL for RAG (Retrieval-Augmented Generation)</li><li><strong>python-dateutil</strong> â€” date and time interval handling (correct month/year processing, month edges)</li><li><strong>aiofiles</strong> â€” asynchronous file operations</li><li><strong>PyMuPDF</strong> â€” PDF text extraction (fast, lightweight)</li><li><strong>python-docx</strong> â€” DOCX text extraction</li><li><strong>chardet</strong> â€” text encoding detection</li><li><strong>beautifulsoup4</strong> â€” HTML parsing and cleaning</li><li><strong>html5lib</strong> â€” HTML parser backend</li><li><strong>pandas</strong> â€” HTML table extraction</li><li><strong>filetype</strong> â€” file type detection via magic bytes</li></ul><h3 id="deployment-system-dependencies" tabindex="-1">Deployment System Dependencies <a class="header-anchor" href="#deployment-system-dependencies" aria-label="Permalink to &quot;Deployment System Dependencies&quot;">â€‹</a></h3><p>Deployment utility (<code>tools/deployment/</code>) uses additional libraries:</p><ul><li><strong>gitpython</strong> â€” repository cloning, Git operations</li><li><strong>requests</strong> â€” GitHub API interaction for creating Merge Requests</li><li><strong>PyYAML</strong> â€” deployment configuration parsing (<code>config.yaml</code>)</li><li><strong>python-dotenv</strong> â€” environment variable loading (tokens, API keys)</li></ul><h2 id="operational-database" tabindex="-1">Operational Database <a class="header-anchor" href="#operational-database" aria-label="Permalink to &quot;Operational Database&quot;">â€‹</a></h2><p>The project supports <strong>two databases</strong> with preset switching:</p><ul><li><strong>SQLite</strong> â€” local database for small projects (simple setup)</li><li><strong>PostgreSQL</strong> â€” production database for production (high performance, scalability)</li></ul><h2 id="core-principles" tabindex="-1">Core Principles <a class="header-anchor" href="#core-principles" aria-label="Permalink to &quot;Core Principles&quot;">â€‹</a></h2><ul><li><strong>Microservice Architecture</strong>: each service operates independently and self-sufficiently</li><li><strong>Event Driven Architecture</strong>: all actions are initiated by events, processed by orchestrator</li><li><strong>Vertical Slice Architecture</strong>: each service is independent, receives only necessary data, doesn&#39;t depend on other services</li><li><strong>Configurability</strong>: all logic and routing are externalized to yaml configs</li><li><strong>Layer Isolation</strong>: clear responsibility separation between layers with dependency hierarchy</li><li><strong>Inter-service Communication</strong> â€” only through DB, except rare cases when a service provides public methods (API) for integration or special tasks</li></ul><h2 id="layers-and-their-purpose" tabindex="-1">Layers and Their Purpose <a class="header-anchor" href="#layers-and-their-purpose" aria-label="Permalink to &quot;Layers and Their Purpose&quot;">â€‹</a></h2><h3 id="foundation-foundation-â€”-fundamental-utilities" tabindex="-1"><strong>Foundation (foundation)</strong> â€” Fundamental Utilities <a class="header-anchor" href="#foundation-foundation-â€”-fundamental-utilities" aria-label="Permalink to &quot;**Foundation (foundation)** â€” Fundamental Utilities&quot;">â€‹</a></h3><ul><li><strong>Purpose:</strong> Critically important utilities required to create DI-container and launch application.</li><li><strong>Location:</strong> <code>plugins/utilities/foundation/</code></li><li><strong>Can use:</strong> Only Python system libraries.</li></ul><h3 id="custom-layers-â€”-thematic-utility-layers" tabindex="-1"><strong>Custom Layers</strong> â€” Thematic Utility Layers <a class="header-anchor" href="#custom-layers-â€”-thematic-utility-layers" aria-label="Permalink to &quot;**Custom Layers** â€” Thematic Utility Layers&quot;">â€‹</a></h3><ul><li><strong>Purpose:</strong> Utilities for specific technologies or platforms (Telegram, API, databases, etc.).</li><li><strong>Location:</strong> <code>plugins/utilities/[layer_name]/</code> (e.g., <code>telegram/</code>, <code>ai/</code>, <code>database/</code>)</li><li><strong>Can use:</strong> Foundation and utilities within its own layer (cross-layer usage not recommended).</li></ul><h3 id="core-core-â€”-infrastructure-utilities" tabindex="-1"><strong>Core (core)</strong> â€” Infrastructure Utilities <a class="header-anchor" href="#core-core-â€”-infrastructure-utilities" aria-label="Permalink to &quot;**Core (core)** â€” Infrastructure Utilities&quot;">â€‹</a></h3><ul><li><strong>Purpose:</strong> Utilities for event creation and processing, DB queue writing, database operations. Highest utility level.</li><li><strong>Location:</strong> <code>plugins/utilities/core/</code></li><li><strong>Can use:</strong> Foundation, custom-layers, and other core utilities.</li></ul><h3 id="services-services-â€”-business-services" tabindex="-1"><strong>Services (services)</strong> â€” Business Services <a class="header-anchor" href="#services-services-â€”-business-services" aria-label="Permalink to &quot;**Services (services)** â€” Business Services&quot;">â€‹</a></h3><ul><li><strong>Purpose:</strong> Core business logic of the application, plugins with specific functionality.</li><li><strong>Location:</strong> <code>plugins/services/</code></li><li><strong>Can use:</strong> Foundation, custom-layers, and core utilities.</li></ul><p>ğŸ“‹ <strong>Practical Layer Usage Examples:</strong> <a href="./PLUGINS_GUIDE#practical-layer-usage-examples">Plugin Guide</a></p><h2 id="dependency-hierarchy" tabindex="-1">Dependency Hierarchy <a class="header-anchor" href="#dependency-hierarchy" aria-label="Permalink to &quot;Dependency Hierarchy&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Foundation (logger, plugins_manager, settings_manager)</span></span>
<span class="line"><span>    â†‘</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  Custom Layers  â”‚</span></span>
<span class="line"><span>â”‚ (telegram, etc) â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>    â†‘</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  Core  â”‚</span></span>
<span class="line"><span>â”‚  â”€â”€â”€&gt;  â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>    â†‘</span></span>
<span class="line"><span>Services</span></span></code></pre></div><h3 id="dependency-rules" tabindex="-1">Dependency Rules <a class="header-anchor" href="#dependency-rules" aria-label="Permalink to &quot;Dependency Rules&quot;">â€‹</a></h3><ol><li><strong>Foundation</strong> â€” use only Python system libraries</li><li><strong>Custom Layers</strong> â€” use foundation and utilities within their layer (cross-layer usage not recommended)</li><li><strong>Core</strong> â€” use foundation, custom-layers, and other core utilities</li><li><strong>Services</strong> â€” use foundation, custom-layers, and core utilities</li><li><strong>Circular dependencies</strong> are <strong>FORBIDDEN</strong></li></ol><p>ğŸ“‹ <strong>Dependency Examples and Practical Recommendations:</strong> <a href="./PLUGINS_GUIDE#dependency-system">Plugin Guide</a></p><h2 id="directory-structure" tabindex="-1">Directory Structure <a class="header-anchor" href="#directory-structure" aria-label="Permalink to &quot;Directory Structure&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>app/                    # Core application</span></span>
<span class="line"><span>â”œâ”€â”€ application.py      # Entry point and orchestrator</span></span>
<span class="line"><span>â””â”€â”€ di_container.py     # Dependency container</span></span>
<span class="line"><span></span></span>
<span class="line"><span>plugins/                # Plugins (utilities and services)</span></span>
<span class="line"><span>â”œâ”€â”€ utilities/          # Supporting utility layers</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ foundation/     # Fundamental utilities (logger, plugins_manager)</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ telegram/       # Telegram utilities (tg_bot_api, tg_utils)</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ ai/             # AI utilities (ai_client)</span></span>
<span class="line"><span>â”‚   â””â”€â”€ core/           # Core utilities (event_processor, database_service)</span></span>
<span class="line"><span>â””â”€â”€ services/           # Business services (plugins)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>utils/                  # System utilities</span></span>
<span class="line"><span>â”œâ”€â”€ database/           # DB utilities (migrations, updates)</span></span>
<span class="line"><span>â”œâ”€â”€ updater/            # Core update utilities</span></span>
<span class="line"><span>â””â”€â”€ ...                 # Other system utilities</span></span>
<span class="line"><span></span></span>
<span class="line"><span>config/                 # Business configuration</span></span>
<span class="line"><span>â””â”€â”€ settings.yaml       # Global system settings</span></span></code></pre></div><p>ğŸ“‹ <strong>Plugin Creation Rules and Folder Structure:</strong> <a href="./PLUGINS_GUIDE#plugin-creation-rules">Plugin Guide</a></p><h2 id="processing-flow" tabindex="-1">Processing Flow <a class="header-anchor" href="#processing-flow" aria-label="Permalink to &quot;Processing Flow&quot;">â€‹</a></h2><ol><li><strong>Application</strong> (<code>app/application.py</code>) initializes foundation utilities (logger, plugins_manager), collects information about all plugins, registers them, creates dependency container, and starts all services.</li><li><strong>Core</strong> utilities (<code>plugins/utilities/core/</code>) receive events from external sources (e.g., Telegram Bot API via HTTP, external services), process them, and pass to orchestrator.</li><li><strong>Orchestrator</strong> analyzes events, finds matching scenarios, and creates execution tasks.</li><li><strong>Services</strong> (<code>plugins/services/</code>) execute business logic through core method calls.</li><li><strong>Inter-service Communication</strong> â€” only through DB.</li></ol><p>ğŸ“‹ <strong>Initialization Algorithm and Loading Order:</strong> <a href="./PLUGINS_GUIDE#initialization-and-loading-order">Plugin Guide</a></p>`,35)])])}const h=n(a,[["render",r]]);export{g as __pageData,h as default};
