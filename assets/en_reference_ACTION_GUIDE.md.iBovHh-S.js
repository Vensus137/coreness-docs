import{_ as t,o as n,c as o,af as a,j as s,a as e}from"./chunks/framework.DZTH9Z-c.js";const u=JSON.parse('{"title":"Actions Guide","description":"Complete reference of all available actions in Coreness. Sending messages, AI operations, HTTP requests, validation, payments and more.","frontmatter":{"title":"Actions Guide","description":"Complete reference of all available actions in Coreness. Sending messages, AI operations, HTTP requests, validation, payments and more.","keywords":"coreness actions, send_message, completion, validate, telegram api, AI actions","head":[["meta",{"property":"og:title","content":"Actions Guide | Coreness"}],["meta",{"property":"og:description","content":"Complete reference of all available actions in Coreness. Sending messages, AI operations, HTTP requests, validation, payments and more."}],["meta",{"property":"og:image","content":"https://docs.coreness.tech/logo-dark.png"}],["meta",{"property":"og:url","content":"https://docs.coreness.tech/en/reference/ACTION_GUIDE"}],["link",{"rel":"canonical","href":"https://docs.coreness.tech/en/reference/ACTION_GUIDE"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"TechArticle\\",\\"headline\\":\\"Actions Guide\\",\\"description\\":\\"Complete reference of all available actions in Coreness. Sending messages, AI operations, HTTP requests, validation, payments and more.\\",\\"url\\":\\"https://docs.coreness.tech/en/reference/ACTION_GUIDE\\"}"]]},"headers":[],"relativePath":"en/reference/ACTION_GUIDE.md","filePath":"en/reference/ACTION_GUIDE.md"}'),l={name:"en/reference/ACTION_GUIDE.md"};function r(d,i,c,p,g,h){return n(),o("div",null,[...i[0]||(i[0]=[a(`<h1 id="üéØ-actions-guide" tabindex="-1">üéØ Actions Guide <a class="header-anchor" href="#üéØ-actions-guide" aria-label="Permalink to &quot;üéØ Actions Guide&quot;">‚Äã</a></h1><blockquote><p><strong>Note:</strong> This guide is being translated. Some parts may still be in Russian or incomplete.</p></blockquote><p>Complete description of all available actions with their parameters and results.</p><h2 id="üìã-table-of-contents" tabindex="-1">üìã Table of Contents <a class="header-anchor" href="#üìã-table-of-contents" aria-label="Permalink to &quot;üìã Table of Contents&quot;">‚Äã</a></h2><ul><li><a href="#ai_rag_service">ai_rag_service</a> (4 actions) <ul><li><a href="#delete_embedding">‚≠ê delete_embedding</a></li><li><a href="#get_recent_chunks">‚≠ê get_recent_chunks</a></li><li><a href="#save_embedding">‚≠ê save_embedding</a></li><li><a href="#search_embedding">‚≠ê search_embedding</a></li></ul></li><li><a href="#ai_service">ai_service</a> (2 actions) <ul><li><a href="#completion">completion</a></li><li><a href="#embedding">embedding</a></li></ul></li><li><a href="#download_service">download_service</a> (1 actions) <ul><li><a href="#download_and_extract">‚≠ê download_and_extract</a></li></ul></li><li><a href="#invoice_service">invoice_service</a> (7 actions) <ul><li><a href="#cancel_invoice">cancel_invoice</a></li><li><a href="#confirm_payment">confirm_payment</a></li><li><a href="#create_invoice">create_invoice</a></li><li><a href="#get_invoice">get_invoice</a></li><li><a href="#get_user_invoices">get_user_invoices</a></li><li><a href="#mark_invoice_as_paid">mark_invoice_as_paid</a></li><li><a href="#reject_payment">reject_payment</a></li></ul></li><li><a href="#scenario_helper">scenario_helper</a> (9 actions) <ul><li><a href="#check_value_in_array">check_value_in_array</a></li><li><a href="#choose_from_array">choose_from_array</a></li><li><a href="#format_data_to_text">format_data_to_text</a></li><li><a href="#generate_array">generate_array</a></li><li><a href="#generate_int">generate_int</a></li><li><a href="#generate_unique_id">generate_unique_id</a></li><li><a href="#modify_array">modify_array</a></li><li><a href="#set_cache">set_cache</a></li><li><a href="#sleep">sleep</a></li></ul></li><li><a href="#scenario_processor">scenario_processor</a> (2 actions) <ul><li><a href="#execute_scenario">execute_scenario</a></li><li><a href="#wait_for_action">wait_for_action</a></li></ul></li><li><a href="#storage_hub">storage_hub</a> (4 actions) <ul><li><a href="#delete_storage">delete_storage</a></li><li><a href="#get_storage">get_storage</a></li><li><a href="#get_storage_groups">get_storage_groups</a></li><li><a href="#set_storage">set_storage</a></li></ul></li><li><a href="#telegram_bot_api">telegram_bot_api</a> (5 actions) <ul><li><a href="#answer_callback_query">answer_callback_query</a></li><li><a href="#build_keyboard">build_keyboard</a></li><li><a href="#delete_message">delete_message</a></li><li><a href="#restrict_chat_member">restrict_chat_member</a></li><li><a href="#send_message">send_message</a></li></ul></li><li><a href="#user_hub">user_hub</a> (8 actions) <ul><li><a href="#clear_user_state">clear_user_state</a></li><li><a href="#delete_user_storage">delete_user_storage</a></li><li><a href="#get_tenant_users">get_tenant_users</a></li><li><a href="#get_user_state">get_user_state</a></li><li><a href="#get_user_storage">get_user_storage</a></li><li><a href="#get_users_by_storage_value">get_users_by_storage_value</a></li><li><a href="#set_user_state">set_user_state</a></li><li><a href="#set_user_storage">set_user_storage</a></li></ul></li><li><a href="#validator">validator</a> (1 actions) <ul><li><a href="#validate">validate</a></li></ul></li></ul><p><sup>‚≠ê ‚Äî extension (additional plugin). For more information contact the <a href="https://t.me/vensus137" target="_blank" rel="noreferrer">developer</a>.</sup></p><p><a id="ai_rag_service"></a></p><h2 id="ai-rag-service" tabindex="-1">ai_rag_service <a class="header-anchor" href="#ai-rag-service" aria-label="Permalink to &quot;ai_rag_service&quot;">‚Äã</a></h2><p><strong>Description:</strong> RAG extension for AI Service (vector search and embeddings management)</p><p><a id="delete_embedding"></a></p><h3 id="‚≠ê-delete-embedding" tabindex="-1">‚≠ê delete_embedding <a class="header-anchor" href="#‚≠ê-delete-embedding" aria-label="Permalink to &quot;‚≠ê delete_embedding&quot;">‚Äã</a></h3><p><strong>Description:</strong> Delete data from vector_storage by document_id or processed_at date</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID (required)</li><li><strong><code>document_id</code></strong> (<code>string</code>, optional) ‚Äî Document ID to delete (all chunks); if set, other params ignored</li><li><strong><code>until_date</code></strong> (<code>string</code>, optional) ‚Äî Delete chunks with processed_at &lt;= until_date (YYYY-MM-DD)</li><li><strong><code>since_date</code></strong> (<code>string</code>, optional) ‚Äî Delete chunks with processed_at &gt;= since_date (YYYY-MM-DD)</li><li><strong><code>metadata_filter</code></strong> (<code>object</code>, optional) ‚Äî Metadata filter (JSON); e.g. chat_id, username</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error info <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li><strong><code>deleted_chunks_count</code></strong> (<code>integer</code>) ‚Äî Number of deleted chunks</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;delete_embedding&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # document_id: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # until_date: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # since_date: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # metadata_filter: object (optional)</span></span></code></pre></div><details><summary>üìñ Additional Information</summary><p><strong>–£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ vector_storage:</strong></p><p><strong>–°–ø–æ—Å–æ–±—ã —É–¥–∞–ª–µ–Ω–∏—è:</strong></p><ol><li>–ü–æ <code>document_id</code> - —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —á–∞–Ω–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è)</li><li>–ü–æ –¥–∞—Ç–µ <code>processed_at</code> - —É–¥–∞–ª—è–µ—Ç —á–∞–Ω–∫–∏ –ø–æ –¥–∞—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏</li><li>–ü–æ <code>metadata_filter</code> - —É–¥–∞–ª—è–µ—Ç —á–∞–Ω–∫–∏ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏</li></ol><p><strong>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∞—Ç—ã:</strong></p><ul><li><code>since_date</code>: —É–¥–∞–ª–∏—Ç—å —Å –¥–∞—Ç—ã (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ)</li><li><code>until_date</code>: —É–¥–∞–ª–∏—Ç—å –¥–æ –¥–∞—Ç—ã (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ)</li><li>–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –æ–±–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (–¥–∏–∞–ø–∞–∑–æ–Ω)</li><li>–§–æ—Ä–º–∞—Ç: &#39;YYYY-MM-DD&#39; –∏–ª–∏ &#39;YYYY-MM-DD HH:MM:SS&#39;</li></ul><p><strong>–ü—Ä–∏–º–µ—Ä—ã:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –ü–æ document_id</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  document_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;doc_12345&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –ü–æ –¥–∞—Ç–µ</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  until_date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2024-01-01&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –î–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  since_date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2024-01-01&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  until_date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2024-12-31&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –ü–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  metadata_filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">chat_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></details><p><a id="get_recent_chunks"></a></p><h3 id="‚≠ê-get-recent-chunks" tabindex="-1">‚≠ê get_recent_chunks <a class="header-anchor" href="#‚≠ê-get-recent-chunks" aria-label="Permalink to &quot;‚≠ê get_recent_chunks&quot;">‚Äã</a></h3><p><strong>Description:</strong> Get last N chunks by created_at (date-based, not vector search; sorted by created_at)</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID (required)</li><li><strong><code>limit_chunks</code></strong> (<code>integer</code>, optional, range: 1-200) ‚Äî Number of chunks (default from search_limit_chunks); works with limit_chars</li><li><strong><code>limit_chars</code></strong> (<code>integer</code>, optional, min: 1) ‚Äî Character limit (applied after limit_chunks)</li><li><strong><code>document_type</code></strong> (<code>string|array</code>, optional) ‚Äî Filter by document type (string or array)</li><li><strong><code>document_id</code></strong> (<code>string|array</code>, optional) ‚Äî Filter by document_id (string or array)</li><li><strong><code>until_date</code></strong> (<code>string</code>, optional) ‚Äî Filter: chunks with processed_at &lt;= until_date</li><li><strong><code>since_date</code></strong> (<code>string</code>, optional) ‚Äî Filter: chunks with processed_at &gt;= since_date</li><li><strong><code>metadata_filter</code></strong> (<code>object</code>, optional) ‚Äî Metadata filter (JSON)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error info <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li><strong><code>chunks</code></strong> (<code>array (of object)</code>) ‚Äî Array of chunks (sorted by created_at DESC)</li><li><strong><code>chunks_count</code></strong> (<code>integer</code>) ‚Äî Number of chunks found</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;get_recent_chunks&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # limit_chunks: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # limit_chars: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # document_type: string|array (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # document_id: string|array (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # until_date: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # since_date: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # metadata_filter: object (optional)</span></span></code></pre></div><details><summary>üìñ Additional Information</summary><p><strong>–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —á–∞–Ω–∫–æ–≤ –ø–æ –¥–∞—Ç–µ (–ù–ï –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫):</strong></p><ul><li>–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —á–∞–Ω–∫–æ–≤, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ <code>created_at</code> (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏, –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏)</li><li>–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–ª–∏ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞</li></ul><p><strong>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:</strong></p><ul><li><code>limit_chunks</code>: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)</li><li><code>limit_chars</code>: –ª–∏–º–∏—Ç –ø–æ —Å–∏–º–≤–æ–ª–∞–º (—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö <code>limit_chunks</code>)</li></ul><p><strong>–§–∏–ª—å—Ç—Ä—ã (–∫–æ–º–±–∏–Ω–∏—Ä—É—é—Ç—Å—è):</strong></p><ul><li><code>document_type</code>, <code>document_id</code>: —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ –º–∞—Å—Å–∏–≤</li><li><code>since_date</code>, <code>until_date</code>: –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç (—Ñ–æ—Ä–º–∞—Ç: &#39;YYYY-MM-DD&#39; –∏–ª–∏ &#39;YYYY-MM-DD HH:MM:SS&#39;)</li><li><code>metadata_filter</code>: JSON –æ–±—ä–µ–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code>{chat_id: 123}</code>)</li></ul><p><strong>–ü—Ä–∏–º–µ—Ä—ã:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —á–∞–Ω–∫–æ–≤</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  limit_chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  document_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;message&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  limit_chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –ü–æ—Å–ª–µ–¥–Ω–∏–µ —á–∞–Ω–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  document_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;doc_123&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  limit_chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –ü–æ—Å–ª–µ–¥–Ω–∏–µ —á–∞–Ω–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  since_date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2024-01-01&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  until_date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2024-12-31&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  limit_chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span></code></pre></div></details><p><a id="save_embedding"></a></p><h3 id="‚≠ê-save-embedding" tabindex="-1">‚≠ê save_embedding <a class="header-anchor" href="#‚≠ê-save-embedding" aria-label="Permalink to &quot;‚≠ê save_embedding&quot;">‚Äã</a></h3><p><strong>Description:</strong> Save text to vector_storage with chunking and embeddings; supports text-only via generate_embedding=false</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID (required)</li><li><strong><code>text</code></strong> (<code>string</code>) ‚Äî Text to save (cleaned and chunked)</li><li><strong><code>document_id</code></strong> (<code>string</code>, optional) ‚Äî Unique document ID; auto-generated if omitted</li><li><strong><code>document_type</code></strong> (<code>string</code>, required, values: [<code>knowledge</code>, <code>chat_history</code>, <code>other</code>]) ‚Äî Document type: knowledge, chat_history, other</li><li><strong><code>role</code></strong> (<code>string</code>, optional, values: [<code>system</code>, <code>user</code>, <code>assistant</code>]) ‚Äî OpenAI message role (default user)</li><li><strong><code>chunk_metadata</code></strong> (<code>object</code>, optional) ‚Äî Chunk metadata (JSON): chat_id, username etc.; used for filtering and in context</li><li><strong><code>model</code></strong> (<code>string</code>, optional) ‚Äî Embedding model (default from ai_client)</li><li><strong><code>dimensions</code></strong> (<code>integer</code>, optional) ‚Äî Embedding dimensions (default 1024)</li><li><strong><code>chunk_size</code></strong> (<code>integer</code>, optional, range: 100-8000) ‚Äî Chunk size in characters (default 1000, ~300-400 tokens, adaptively increased for tables)</li><li><strong><code>chunk_overlap</code></strong> (<code>integer</code>, optional, range: 0-1000) ‚Äî Chunk overlap in characters (~20% of chunk_size)</li><li><strong><code>replace_existing</code></strong> (<code>boolean</code>, optional) ‚Äî Replace existing document (default false; ALREADY_EXISTS if exists)</li><li><strong><code>generate_embedding</code></strong> (<code>boolean</code>, optional) ‚Äî Generate embeddings for chunks (default true); false = text only</li><li><strong><code>created_at</code></strong> (<code>string</code>, optional) ‚Äî Creation date (ISO/YYYY-MM-DD); default current time</li><li>üîë <strong><code>ai_token</code></strong> (<code>string</code>, optional) ‚Äî AI API key from tenant config; required if generate_embedding=true</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code: ALREADY_EXISTS, INTERNAL_ERROR, VALIDATION_ERROR</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details (e.g. field validation errors)</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li><strong><code>document_id</code></strong> (<code>string</code>) ‚Äî Saved document ID (provided or generated)</li><li><strong><code>document_type</code></strong> (<code>string</code>) ‚Äî Document type</li><li><strong><code>chunks_count</code></strong> (<code>integer</code>) ‚Äî Number of chunks created</li><li><strong><code>model</code></strong> (<code>string</code>) (optional) ‚Äî Embedding model used (if generate_embedding=true)</li><li><strong><code>dimensions</code></strong> (<code>integer</code>) (optional) ‚Äî Embedding dimensions (if generate_embedding=true)</li><li><strong><code>total_tokens</code></strong> (<code>integer</code>) (optional) ‚Äî Total tokens in chunks (if generate_embedding=true)</li><li><strong><code>text_length</code></strong> (<code>integer</code>) ‚Äî Source text length (after cleaning)</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîë ‚Äî field that is automatically taken from tenant configuration (_config) and does not require explicit passing in params</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;save_embedding&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # document_id: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    document_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # role: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # chunk_metadata: object (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # model: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # dimensions: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # chunk_size: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # chunk_overlap: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # replace_existing: boolean (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # generate_embedding: boolean (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # created_at: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ai_token: string (optional)</span></span></code></pre></div><details><summary>üìñ Additional Information</summary><p><strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º –Ω–∞ —á–∞–Ω–∫–∏:</strong></p><ol><li>–û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ (–ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã, –Ω–µ–≤–∏–¥–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã)</li><li>–†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏ (–≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º/–∞–±–∑–∞—Ü–∞–º ‚Üí –ø–æ —Å–∏–º–≤–æ–ª–∞–º)</li><li>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –µ—Å–ª–∏ <code>generate_embedding=true</code>)</li><li>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ <code>vector_storage</code></li></ol><p><strong>–†–µ–∂–∏–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:</strong></p><ul><li><code>generate_embedding=true</code> (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏ –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞</li><li><code>generate_embedding=false</code>: —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –±–µ–∑ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (—ç–∫–æ–Ω–æ–º–∏—Ç —Ç–æ–∫–µ–Ω—ã, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç <code>ai_token</code>)</li></ul><p><strong>–ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ —á–∞–Ω–∫–æ–≤ (chunk_overlap):</strong></p><ul><li>–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–∏—Å–∫–∞</li><li>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è ~20% –æ—Ç <code>chunk_size</code> (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100 –ø—Ä–∏ <code>chunk_size=512</code>)</li><li>–†–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –¥–æ —Ü–µ–ª—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø—Ä–∏ —Ä–∞–∑–±–∏–µ–Ω–∏–∏</li></ul><p><strong>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è document_id:</strong></p><ul><li>–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)</li><li>Seed: <code>{tenant_id}:{document_type}:{MD5(text)}</code></li><li>–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≥–æ –∂–µ —Ç–µ–∫—Å—Ç–∞ –≤–µ—Ä–Ω–µ—Ç —Ç–æ—Ç –∂–µ ID</li></ul><p><strong>–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:</strong></p><ul><li><code>replace_existing=false</code> (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): –æ—à–∏–±–∫–∞ ALREADY_EXISTS –µ—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</li><li><code>replace_existing=true</code>: —Å—Ç–∞—Ä—ã–µ —á–∞–Ω–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è, —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ</li></ul><p><strong>–ü—Ä–∏–º–µ—Ä:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">save_embedding</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;–î–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç...&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  document_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;knowledge&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  chunk_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">512</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  chunk_overlap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –û—Ç–≤–µ—Ç:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">success</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  document_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;doc_12345&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  chunks_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  total_tokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">150</span></span></code></pre></div></details><p><a id="search_embedding"></a></p><h3 id="‚≠ê-search-embedding" tabindex="-1">‚≠ê search_embedding <a class="header-anchor" href="#‚≠ê-search-embedding" aria-label="Permalink to &quot;‚≠ê search_embedding&quot;">‚Äã</a></h3><p><strong>Description:</strong> Search similar chunks by text or vector (cosine similarity)</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID (required)</li><li><strong><code>query_text</code></strong> (<code>string</code>, optional) ‚Äî Query text (converted to embedding); use query_text or query_vector</li><li><strong><code>query_vector</code></strong> (<code>array</code>, optional) ‚Äî Precomputed vector (array); use query_text or query_vector</li><li><strong><code>limit_chunks</code></strong> (<code>integer</code>, optional, range: 1-200) ‚Äî Number of results (top-k); works with limit_chars</li><li><strong><code>limit_chars</code></strong> (<code>integer</code>, optional, min: 1) ‚Äî Character limit (applied after limit_chunks)</li><li><strong><code>min_similarity</code></strong> (<code>number</code>, optional, range: 0.0-1.0) ‚Äî Min similarity threshold (cosine)</li><li><strong><code>document_id</code></strong> (<code>string|array</code>, optional) ‚Äî Filter by document_id (string or array)</li><li><strong><code>document_type</code></strong> (<code>string|array</code>, optional) ‚Äî Filter by document type (string or array)</li><li><strong><code>until_date</code></strong> (<code>string</code>, optional) ‚Äî Filter: chunks with processed_at &lt;= until_date</li><li><strong><code>since_date</code></strong> (<code>string</code>, optional) ‚Äî Filter: chunks with processed_at &gt;= since_date</li><li><strong><code>metadata_filter</code></strong> (<code>object</code>, optional) ‚Äî Metadata filter (JSON)</li><li><strong><code>model</code></strong> (<code>string</code>, optional) ‚Äî Embedding model (if query_text)</li><li><strong><code>dimensions</code></strong> (<code>integer</code>, optional) ‚Äî Embedding dimensions (if query_text)</li><li>üîë <strong><code>ai_token</code></strong> (<code>string</code>, optional) ‚Äî AI API key; required if query_text set</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error info <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li><strong><code>chunks</code></strong> (<code>array (of object)</code>) ‚Äî Array of found chunks</li><li><strong><code>chunks_count</code></strong> (<code>integer</code>) ‚Äî Number of chunks found</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîë ‚Äî field that is automatically taken from tenant configuration (_config) and does not require explicit passing in params</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;search_embedding&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # query_text: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # query_vector: array (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # limit_chunks: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # limit_chars: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # min_similarity: number (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # document_id: string|array (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # document_type: string|array (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # until_date: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # since_date: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # metadata_filter: object (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # model: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # dimensions: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ai_token: string (optional)</span></span></code></pre></div><details><summary>üìñ Additional Information</summary><p><strong>–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —á–∞–Ω–∫–æ–≤:</strong></p><ul><li>–ü–æ–∏—Å–∫ –ø–æ cosine similarity –º–µ–∂–¥—É –≤–µ–∫—Ç–æ—Ä–∞–º–∏</li><li>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç HNSW –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞</li><li>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ —É–±—ã–≤–∞–Ω–∏—é similarity</li></ul><p><strong>–ó–∞–ø—Ä–æ—Å (—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–¥–Ω–æ –∏–∑):</strong></p><ul><li><code>query_text</code>: —Ç–µ–∫—Å—Ç (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è embedding –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)</li><li><code>query_vector</code>: –≥–æ—Ç–æ–≤—ã–π –≤–µ–∫—Ç–æ—Ä (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á)</li></ul><p><strong>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞:</strong></p><ul><li><code>limit_chunks</code>: top-k —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)</li><li><code>limit_chars</code>: –ª–∏–º–∏—Ç –ø–æ —Å–∏–º–≤–æ–ª–∞–º (—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö <code>limit_chunks</code>)</li><li><code>min_similarity</code>: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ (0.0-1.0, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.7)</li></ul><p><strong>–§–∏–ª—å—Ç—Ä—ã (–∫–æ–º–±–∏–Ω–∏—Ä—É—é—Ç—Å—è):</strong></p><ul><li><code>document_type</code>, <code>document_id</code>: —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ –º–∞—Å—Å–∏–≤</li><li><code>since_date</code>, <code>until_date</code>: –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç (—Ñ–æ—Ä–º–∞—Ç: &#39;YYYY-MM-DD&#39; –∏–ª–∏ &#39;YYYY-MM-DD HH:MM:SS&#39;)</li><li><code>metadata_filter</code>: JSON –æ–±—ä–µ–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code>{chat_id: 123}</code>)</li></ul><p><strong>–ü—Ä–∏–º–µ—Ä—ã:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  query_text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç RAG?&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  limit_chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  min_similarity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.75</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  query_text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;–í–æ–ø—Ä–æ—Å&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  document_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;document&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  since_date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2024-01-01&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  until_date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2024-12-31&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –ü–æ–∏—Å–∫ —Å –ª–∏–º–∏—Ç–æ–º –ø–æ —Å–∏–º–≤–æ–ª–∞–º</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  query_text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;–í–æ–ø—Ä–æ—Å&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  limit_chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  limit_chars</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span></span></code></pre></div></details><p><a id="ai_service"></a></p><h2 id="ai-service" tabindex="-1">ai_service <a class="header-anchor" href="#ai-service" aria-label="Permalink to &quot;ai_service&quot;">‚Äã</a></h2><p><strong>Description:</strong> Service for AI integration in scenarios</p><p><a id="completion"></a></p><h3 id="completion" tabindex="-1">completion <a class="header-anchor" href="#completion" aria-label="Permalink to &quot;completion&quot;">‚Äã</a></h3><p><strong>Description:</strong> AI completion via AI</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>prompt</code></strong> (<code>string</code>) ‚Äî User request text</li><li><strong><code>system_prompt</code></strong> (<code>string</code>, optional) ‚Äî System prompt for context</li><li><strong><code>model</code></strong> (<code>string</code>, optional) ‚Äî AI model (default from settings)</li><li><strong><code>max_tokens</code></strong> (<code>integer</code>, optional) ‚Äî Maximum tokens (default from settings)</li><li><strong><code>temperature</code></strong> (<code>float</code>, optional, range: 0.0-2.0) ‚Äî Generation temperature (default from settings)</li><li><strong><code>context</code></strong> (<code>string</code>, optional) ‚Äî Custom context (added to final user message in ADDITIONAL CONTEXT block with other chunks from rag_chunks)</li><li><strong><code>rag_chunks</code></strong> (<code>array (of object)</code>, optional) ‚Äî Array of RAG search chunks for building messages. Types: chat_history, knowledge, other. Format: [{content, document_type, role, processed_at, ...}]</li><li><strong><code>json_mode</code></strong> (<code>string</code>, optional, values: [<code>json_object</code>, <code>json_schema</code>]) ‚Äî JSON mode for structured response: &#39;json_object&#39; or &#39;json_schema&#39;</li><li><strong><code>json_schema</code></strong> (<code>object</code>, optional) ‚Äî JSON schema for json_schema mode (required when json_mode=&#39;json_schema&#39;)</li><li><strong><code>tools</code></strong> (<code>array (of object)</code>, optional) ‚Äî Array of tool objects (tool calling). Each item is an object: type &#39;function&#39;, function: { name, description, parameters }. parameters is JSON Schema for the call arguments (OpenAI-compatible format).</li><li><strong><code>tool_choice</code></strong> (<code>string</code>, optional) ‚Äî Tool selection. String: &#39;none&#39; (do not call), &#39;auto&#39; (default when tools present), &#39;required&#39; (must call at least one). Object: force one function ‚Äî {&quot;type&quot;: &quot;function&quot;, &quot;function&quot;: {&quot;name&quot;: &quot;function_name&quot;}}.</li><li><strong><code>chunk_format</code></strong> (<code>object</code>, optional) ‚Äî Chunk display format in context. Templates use $ markers. $content + chunk_metadata. Fallback: $field|fallback:value. Markers apply only to chunk data.</li><li>üîë <strong><code>ai_token</code></strong> (<code>string</code>) ‚Äî AI API key from tenant config (_config.ai_token)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error, timeout</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details (e.g. field validation errors)</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li><strong><code>response_completion</code></strong> (<code>string</code>) ‚Äî AI completion response</li><li><strong><code>prompt_tokens</code></strong> (<code>integer</code>) ‚Äî Input tokens (prompt + context)</li><li><strong><code>completion_tokens</code></strong> (<code>integer</code>) ‚Äî Output tokens (generated response)</li><li><strong><code>total_tokens</code></strong> (<code>integer</code>) ‚Äî Total tokens (prompt + completion)</li><li><strong><code>model</code></strong> (<code>string</code>) ‚Äî Model used</li><li><strong><code>response_dict</code></strong> (<code>object</code>) (optional) ‚Äî Parsed dict from JSON response (when using json_mode)</li><li><strong><code>tool_calls</code></strong> (<code>array (of object)</code>) (optional) ‚Äî When using tools ‚Äî array of call objects. Each item: id, type, function: { name, arguments }. arguments is a JSON string with call parameters (different keys per function); parse in scenario if needed.</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîë ‚Äî field that is automatically taken from tenant configuration (_config) and does not require explicit passing in params</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;completion&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    prompt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # system_prompt: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # model: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # max_tokens: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # temperature: float (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # context: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # rag_chunks: array (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # json_mode: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # json_schema: object (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # tools: array (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # tool_choice: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # chunk_format: object (optional)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ai_token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span></code></pre></div><details><summary>üìñ Additional Information</summary><p><strong>JSON —Ä–µ–∂–∏–º—ã:</strong></p><ul><li><code>json_object</code>: –º–æ–¥–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON (–ø–∞—Ä—Å–∏—Ç—Å—è –≤ <code>response_dict</code>)</li><li><code>json_schema</code>: —Å—Ç—Ä–æ–≥–∞—è JSON —Å—Ö–µ–º–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è <code>json_schema</code> –ø–∞—Ä–∞–º–µ—Ç—Ä)</li></ul><p><strong>Tool Calling:</strong></p><ul><li><code>tools</code> ‚Äî –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ (–∫–∞–∂–¥—ã–π: type, function.name, function.description, function.parameters –ø–æ JSON Schema)</li><li>–ú–æ–¥–µ–ª—å —Ä–µ—à–∞–µ—Ç, –∫–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑–≤–∞—Ç—å –∏ —Å –∫–∞–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏; –≤—ã–∑–æ–≤—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ <code>response_data.tool_calls</code></li><li><code>tool_calls</code> ‚Äî –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤: id, type, function.name, function.arguments (JSON-—Å—Ç—Ä–æ–∫–∞); –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ü–∏–∫–ª—ã ‚Äî –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏</li><li><code>tool_choice</code>: —Å—Ç—Ä–æ–∫–∞ &#39;none&#39;|&#39;auto&#39;|&#39;required&#39; –∏–ª–∏ –æ–±—ä–µ–∫—Ç –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏</li></ul><p><strong>–§–æ—Ä–º–∞—Ç —á–∞–Ω–∫–æ–≤ (chunk_format):</strong></p><ul><li>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–∞–Ω–∫–æ–≤ –∏–∑ RAG —á–µ—Ä–µ–∑ —à–∞–±–ª–æ–Ω—ã —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ <code>$</code></li><li>–î–æ—Å—Ç—É–ø–Ω—ã: <code>$content</code> (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) + –ª—é–±—ã–µ –ø–æ–ª—è –∏–∑ <code>chunk_metadata</code></li><li>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è fallback: <code>$field|fallback:–∑–Ω–∞—á–µ–Ω–∏–µ</code> (–µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ/–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)</li><li>–ú–∞—Ä–∫–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å –¥–∞–Ω–Ω—ã–º–∏ —á–∞–Ω–∫–∞ (content + chunk_metadata)</li><li>–ü—Ä–∏–º–µ—Ä—ã: <code>&quot;[$username]: $content&quot;</code>, <code>&quot;[$category|fallback:–û–±—â–µ–µ]: $content&quot;</code></li><li>–ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è <code>chat_history</code>, <code>knowledge</code>, <code>other</code></li></ul></details><p><a id="embedding"></a></p><h3 id="embedding" tabindex="-1">embedding <a class="header-anchor" href="#embedding" aria-label="Permalink to &quot;embedding&quot;">‚Äã</a></h3><p><strong>Description:</strong> Generate text embedding via AI</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>text</code></strong> (<code>string</code>) ‚Äî Text for embedding generation</li><li><strong><code>model</code></strong> (<code>string</code>, optional) ‚Äî Embedding model (default from ai_client.default_embedding_model)</li><li><strong><code>dimensions</code></strong> (<code>integer</code>, optional) ‚Äî Embedding dimensions (default from ai_client). Supported for OpenAI text-embedding-3-* only</li><li>üîë <strong><code>ai_token</code></strong> (<code>string</code>) ‚Äî AI API key from tenant config (_config.ai_token)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details (e.g. field validation errors)</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li><strong><code>embedding</code></strong> (<code>array (of number)</code>) ‚Äî Embedding vector (list of numbers)</li><li><strong><code>model</code></strong> (<code>string</code>) ‚Äî Model used</li><li><strong><code>dimensions</code></strong> (<code>integer</code>) ‚Äî Embedding dimensions</li><li><strong><code>total_tokens</code></strong> (<code>integer</code>) ‚Äî Total tokens</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîë ‚Äî field that is automatically taken from tenant configuration (_config) and does not require explicit passing in params</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # model: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # dimensions: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ai_token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span></code></pre></div><details><summary>üìñ Additional Information</summary><p><strong>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π —Ç–µ–∫—Å—Ç–∞ (embeddings):</strong></p><ul><li>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è RAG (Retrieval-Augmented Generation) –∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞</li><li>–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª (<code>embedding</code>) - –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞</li></ul><p><strong>–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å (dimensions):</strong></p><ul><li>–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1024 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ <code>ai_client.default_embedding_dimensions</code>)</li><li>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–µ –≤—Å–µ–º–∏ –º–æ–¥–µ–ª—è–º–∏ (–¥–ª—è –º–æ–¥–µ–ª–µ–π –±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞)</li></ul><p><strong>–ü—Ä–∏–º–µ—Ä:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">embedding</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;–¢–µ–∫—Å—Ç –¥–ª—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  dimensions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1024</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –û—Ç–≤–µ—Ç:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">success</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  embedding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-0.456</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –í–µ–∫—Ç–æ—Ä –∏–∑ 1024 —á–∏—Å–µ–ª</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  dimensions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1024</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  total_tokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span></span></code></pre></div></details><p><a id="download_service"></a></p><h2 id="download-service" tabindex="-1">download_service <a class="header-anchor" href="#download-service" aria-label="Permalink to &quot;download_service&quot;">‚Äã</a></h2><p><strong>Description:</strong> Service for downloading files from URLs and extracting text content</p><p><a id="download_and_extract"></a></p><h3 id="‚≠ê-download-and-extract" tabindex="-1">‚≠ê download_and_extract <a class="header-anchor" href="#‚≠ê-download-and-extract" aria-label="Permalink to &quot;‚≠ê download_and_extract&quot;">‚Äã</a></h3><p><strong>Description:</strong> Download file from URL and extract text content. Supports: PDF, DOCX, TXT, MD, HTML, CSV (incl. Google Sheets). Auto-detects file type via magic bytes, Content-Type or extension</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID (required for file isolation)</li><li><strong><code>url</code></strong> (<code>string</code>) ‚Äî URL to download file from (direct link, Google Drive, Google Docs/Sheets, etc.)</li><li><strong><code>file_type</code></strong> (<code>string</code>, optional, values: [<code>pdf</code>, <code>docx</code>, <code>txt</code>, <code>md</code>, <code>html</code>, <code>csv</code>]) ‚Äî File type hint (pdf, docx, txt, md, html, csv). If not set - auto-detected via magic bytes, Content-Type or extension</li><li><strong><code>keep_file</code></strong> (<code>boolean</code>, optional) ‚Äî Keep downloaded file instead of auto-cleanup (default false - file deleted after extraction)</li><li><strong><code>max_file_size_mb</code></strong> (<code>integer</code>, optional, range: 1-500) ‚Äî Max file size in MB for this specific action (overrides default setting). Checked via HEAD request before download</li><li><strong><code>download_timeout_seconds</code></strong> (<code>integer</code>, optional, range: 10-3600) ‚Äî Download timeout in seconds for this specific action (overrides default setting)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code: VALIDATION_ERROR, FILE_TOO_LARGE, DOWNLOAD_FAILED, UNSUPPORTED_FORMAT, EXTRACTION_FAILED, TIMEOUT, INTERNAL_ERROR</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details (e.g. field validation errors)</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li><strong><code>file_text</code></strong> (<code>string</code>) ‚Äî Extracted text from file</li><li><strong><code>file_path</code></strong> (<code>string</code>) (optional) ‚Äî Path to downloaded file (only if keep_file=true, otherwise null)</li><li><strong><code>file_metadata</code></strong> (<code>object</code>) ‚Äî File metadata</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;download_and_extract&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # file_type: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # keep_file: boolean (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # max_file_size_mb: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # download_timeout_seconds: integer (optional)</span></span></code></pre></div><p><a id="invoice_service"></a></p><h2 id="invoice-service" tabindex="-1">invoice_service <a class="header-anchor" href="#invoice-service" aria-label="Permalink to &quot;invoice_service&quot;">‚Äã</a></h2><p><strong>Description:</strong> Service for invoices (create, manage, process payments)</p><p><a id="cancel_invoice"></a></p><h3 id="cancel-invoice" tabindex="-1">cancel_invoice <a class="header-anchor" href="#cancel-invoice" aria-label="Permalink to &quot;cancel_invoice&quot;">‚Äã</a></h3><p><strong>Description:</strong> Cancel invoice (set is_cancelled flag)</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>invoice_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Invoice ID (required)</li></ul><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cancel_invoice&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    invoice_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span></code></pre></div><p><a id="confirm_payment"></a></p><h3 id="confirm-payment" tabindex="-1">confirm_payment <a class="header-anchor" href="#confirm-payment" aria-label="Permalink to &quot;confirm_payment&quot;">‚Äã</a></h3><p><strong>Description:</strong> Confirm payment (answer pre_checkout_query with confirm)</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID</li><li><strong><code>bot_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Bot ID</li><li><strong><code>pre_checkout_query_id</code></strong> (<code>string</code>, required, min length: 1) ‚Äî Pre-checkout query ID (required)</li><li><strong><code>invoice_payload</code></strong> (<code>string</code>, optional, min length: 1) ‚Äî Invoice ID from payload (optional, to check status before confirm)</li><li><strong><code>error_message</code></strong> (<code>string</code>, optional) ‚Äî Error message when rejecting payment (optional; when invoice cancelled or already paid)</li></ul><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success (payment confirmed), failed (rejected by business logic), error (technical error)</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code: INVOICE_CANCELLED, INVOICE_ALREADY_PAID (when result=failed)</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;confirm_payment&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    bot_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    pre_checkout_query_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # invoice_payload: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # error_message: string (optional)</span></span></code></pre></div><p><a id="create_invoice"></a></p><h3 id="create-invoice" tabindex="-1">create_invoice <a class="header-anchor" href="#create-invoice" aria-label="Permalink to &quot;create_invoice&quot;">‚Äã</a></h3><p><strong>Description:</strong> Create invoice in DB and send/create link</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID</li><li><strong><code>bot_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Bot ID</li><li><strong><code>target_user_id</code></strong> (<code>integer</code>, optional, min: 1) ‚Äî User ID for invoice (optional, default from event user_id)</li><li><strong><code>chat_id</code></strong> (<code>integer</code>, optional) ‚Äî Chat ID for sending (required for send, not for link)</li><li><strong><code>title</code></strong> (<code>string</code>, required, min length: 1) ‚Äî Product/service title (required)</li><li><strong><code>description</code></strong> (<code>string</code>) ‚Äî Product/service description</li><li><strong><code>amount</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Star amount (required, integer)</li><li><strong><code>currency</code></strong> (<code>string</code>, optional) ‚Äî Currency (default XTR for stars)</li><li><strong><code>as_link</code></strong> (<code>boolean</code>, optional) ‚Äî Create as link instead of send (default false)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li><strong><code>invoice_id</code></strong> (<code>integer</code>) ‚Äî Created invoice ID</li><li><strong><code>invoice_message_id</code></strong> (<code>integer</code>) (optional) ‚Äî Sent message ID with invoice (when as_link=false)</li><li><strong><code>invoice_link</code></strong> (<code>string</code>) (optional) ‚Äî Invoice link (when as_link=true)</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;create_invoice&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    bot_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # target_user_id: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # chat_id: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    amount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # currency: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # as_link: boolean (optional)</span></span></code></pre></div><p><a id="get_invoice"></a></p><h3 id="get-invoice" tabindex="-1">get_invoice <a class="header-anchor" href="#get-invoice" aria-label="Permalink to &quot;get_invoice&quot;">‚Äã</a></h3><p><strong>Description:</strong> Get invoice info</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>invoice_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Invoice ID (required)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li><strong><code>invoice</code></strong> (<code>object</code>) ‚Äî Invoice data</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;get_invoice&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    invoice_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span></code></pre></div><p><a id="get_user_invoices"></a></p><h3 id="get-user-invoices" tabindex="-1">get_user_invoices <a class="header-anchor" href="#get-user-invoices" aria-label="Permalink to &quot;get_user_invoices&quot;">‚Äã</a></h3><p><strong>Description:</strong> Get all user invoices</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>target_user_id</code></strong> (<code>integer</code>, optional, min: 1) ‚Äî User ID for invoices (optional; default from event user_id)</li><li><strong><code>include_cancelled</code></strong> (<code>boolean</code>, optional) ‚Äî Include cancelled invoices (default false)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li><strong><code>invoices</code></strong> (<code>array (of object)</code>) ‚Äî Array of user invoices</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;get_user_invoices&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # target_user_id: integer (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # include_cancelled: boolean (optional)</span></span></code></pre></div><p><a id="mark_invoice_as_paid"></a></p><h3 id="mark-invoice-as-paid" tabindex="-1">mark_invoice_as_paid <a class="header-anchor" href="#mark-invoice-as-paid" aria-label="Permalink to &quot;mark_invoice_as_paid&quot;">‚Äã</a></h3><p><strong>Description:</strong> Mark invoice as paid (payment_successful event handler)</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>invoice_payload</code></strong> (<code>string</code>, required, min length: 1) ‚Äî ID –∏–Ω–≤–æ–π—Å–∞ –∏–∑ payload —Å–æ–±—ã—Ç–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</li><li><strong><code>telegram_payment_charge_id</code></strong> (<code>string</code>, required, min length: 1) ‚Äî ID –ø–ª–∞—Ç–µ–∂–∞ –≤ Telegram (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</li><li><strong><code>paid_at</code></strong> (<code>string</code>, optional) ‚Äî –î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞)</li></ul><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mark_invoice_as_paid&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    invoice_payload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    telegram_payment_charge_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # paid_at: string (optional)</span></span></code></pre></div><p><a id="reject_payment"></a></p><h3 id="reject-payment" tabindex="-1">reject_payment <a class="header-anchor" href="#reject-payment" aria-label="Permalink to &quot;reject_payment&quot;">‚Äã</a></h3><p><strong>Description:</strong> Reject payment (answer pre_checkout_query with reject)</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID</li><li><strong><code>bot_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Bot ID</li><li><strong><code>pre_checkout_query_id</code></strong> (<code>string</code>, required, min length: 1) ‚Äî Pre-checkout query ID (required)</li><li><strong><code>error_message</code></strong> (<code>string</code>, optional) ‚Äî Error message (optional)</li></ul><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;reject_payment&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    bot_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    pre_checkout_query_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # error_message: string (optional)</span></span></code></pre></div><p><a id="scenario_helper"></a></p><h2 id="scenario-helper" tabindex="-1">scenario_helper <a class="header-anchor" href="#scenario-helper" aria-label="Permalink to &quot;scenario_helper&quot;">‚Äã</a></h2><p><strong>Description:</strong> Helper utilities for scenario execution management</p><p><a id="check_value_in_array"></a></p><h3 id="check-value-in-array" tabindex="-1">check_value_in_array <a class="header-anchor" href="#check-value-in-array" aria-label="Permalink to &quot;check_value_in_array&quot;">‚Äã</a></h3><p><strong>Description:</strong> Check if value exists in array</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>array</code></strong> (<code>array</code>) ‚Äî –ú–∞—Å—Å–∏–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</li><li><strong><code>value</code></strong> (<code>any</code>) ‚Äî –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –º–∞—Å—Å–∏–≤–µ</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî –†–µ–∑—É–ª—å—Ç–∞—Ç: success (–Ω–∞–π–¥–µ–Ω–æ), not_found (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ), error (–æ—à–∏–±–∫–∞)</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>response_index</code></strong> (<code>integer</code>) ‚Äî –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä (–∏–Ω–¥–µ–∫—Å) –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–∂–¥–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤–µ (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ result: success)</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;check_value_in_array&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: []</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span></span></code></pre></div><p><a id="choose_from_array"></a></p><h3 id="choose-from-array" tabindex="-1">choose_from_array <a class="header-anchor" href="#choose-from-array" aria-label="Permalink to &quot;choose_from_array&quot;">‚Äã</a></h3><p><strong>Description:</strong> Pick random items from array without repeats</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>array</code></strong> (<code>array</code>) ‚Äî –ò—Å—Ö–æ–¥–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤</li><li><strong><code>count</code></strong> (<code>integer</code>, required, min: 1) ‚Äî –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞ (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)</li><li><strong><code>seed</code></strong> (<code>any</code>, optional) ‚Äî Seed –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ–º, —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ –¥—Ä—É–≥–∏–º —Ç–∏–ø–æ–º)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>random_list</code></strong> (<code>array</code>) ‚Äî –ú–∞—Å—Å–∏–≤ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)</li><li><strong><code>random_seed</code></strong> (<code>string</code>) (optional) ‚Äî –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π seed (–µ—Å–ª–∏ –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å)</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;choose_from_array&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: []</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # seed: any (optional)</span></span></code></pre></div><p><a id="format_data_to_text"></a></p><h3 id="format-data-to-text" tabindex="-1">format_data_to_text <a class="header-anchor" href="#format-data-to-text" aria-label="Permalink to &quot;format_data_to_text&quot;">‚Äã</a></h3><p><strong>Description:</strong> Format structured data (JSON/YAML) to text for prompts and messages</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>format_type</code></strong> (<code>string</code>, required, values: [<code>list</code>, <code>structured</code>]) ‚Äî –¢–∏–ø —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: &#39;list&#39; (–ø—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ —Å —à–∞–±–ª–æ–Ω–æ–º —á–µ—Ä–µ–∑ $), &#39;structured&#39; (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏)</li><li><strong><code>input_data</code></strong> (<code>any</code>) ‚Äî –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</li><li><strong><code>title</code></strong> (<code>string</code>, optional) ‚Äî –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —Å–ø–∏—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</li><li><strong><code>item_template</code></strong> (<code>string</code>, optional, min length: 1) ‚Äî –®–∞–±–ª–æ–Ω —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∞ &#39;list&#39; —á–µ—Ä–µ–∑ $ (–Ω–∞–ø—Ä–∏–º–µ—Ä: &#39;- &quot;$id&quot; - $description&#39;). –û–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø—Ä–∏ format_type: &#39;list&#39;</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>formatted_text</code></strong> (<code>string</code>) ‚Äî –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;format_data_to_text&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    format_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    input_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # title: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # item_template: string (optional)</span></span></code></pre></div><details><summary>üìñ Additional Information</summary><p><strong>–§–æ—Ä–º–∞—Ç—ã:</strong></p><ul><li><strong><code>list</code></strong> ‚Äî –ø—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ —Å —à–∞–±–ª–æ–Ω–æ–º —á–µ—Ä–µ–∑ <code>$</code></li><li><strong><code>structured</code></strong> ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: <code>name ‚Äî description</code>, –±–ª–æ–∫ <code>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:</code> —Å –¥–µ—Ç–∞–ª—è–º–∏</li></ul><p><strong>–ü—Ä–∏–º–µ—Ä—ã:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –§–æ—Ä–º–∞—Ç list</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;format_data_to_text&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    format_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;list&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;–î–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è:&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    item_template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;- &quot;$id&quot; - $description&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    input_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{storage_values.ai_router.intents}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ _cache.format_data_to_text.formatted_text:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –î–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - &quot;random_user&quot; - –í—ã–±—Ä–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –§–æ—Ä–º–∞—Ç structured</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;format_data_to_text&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    format_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;structured&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    input_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{storage_values.ai_router.actions}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ _cache.format_data_to_text.formatted_text:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># call_random_user ‚Äî –í—ã–±—Ä–∞—Ç—å N –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –≥—Ä—É–ø–ø—ã</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - count (integer) ‚Äî –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1</span></span></code></pre></div><p><strong>–í–∞–∂–Ω–æ:</strong></p><ul><li>–®–∞–±–ª–æ–Ω –¥–ª—è <code>list</code> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç <code>$</code> –≤–º–µ—Å—Ç–æ <code>{}</code> –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏</li><li>–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ <code>_cache.format_data_to_text.formatted_text</code> (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</li><li>–ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω <code>_namespace</code> –≤ params, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –≤ <code>_cache.{_namespace}.formatted_text</code></li></ul></details><p><a id="generate_array"></a></p><h3 id="generate-array" tabindex="-1">generate_array <a class="header-anchor" href="#generate-array" aria-label="Permalink to &quot;generate_array&quot;">‚Äã</a></h3><p><strong>Description:</strong> Generate array of random numbers in range (default no repeats)</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>min</code></strong> (<code>integer</code>) ‚Äî Minimum value (inclusive)</li><li><strong><code>max</code></strong> (<code>integer</code>) ‚Äî Maximum value (inclusive)</li><li><strong><code>count</code></strong> (<code>integer</code>, required, min: 1) ‚Äî –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∏—Å–µ–ª –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</li><li><strong><code>seed</code></strong> (<code>any</code>, optional) ‚Äî Seed –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ–º, —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ –¥—Ä—É–≥–∏–º —Ç–∏–ø–æ–º)</li><li><strong><code>allow_duplicates</code></strong> (<code>boolean</code>, optional) ‚Äî –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é false - –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>random_list</code></strong> (<code>array (of integer)</code>) ‚Äî –ú–∞—Å—Å–∏–≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–∏—Å–µ–ª</li><li><strong><code>random_seed</code></strong> (<code>string</code>) (optional) ‚Äî –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π seed (–µ—Å–ª–∏ –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å)</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_array&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # seed: any (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # allow_duplicates: boolean (optional)</span></span></code></pre></div><p><a id="generate_int"></a></p><h3 id="generate-int" tabindex="-1">generate_int <a class="header-anchor" href="#generate-int" aria-label="Permalink to &quot;generate_int&quot;">‚Äã</a></h3><p><strong>Description:</strong> Generate random integer in range</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>min</code></strong> (<code>integer</code>) ‚Äî Minimum value (inclusive)</li><li><strong><code>max</code></strong> (<code>integer</code>) ‚Äî Maximum value (inclusive)</li><li><strong><code>seed</code></strong> (<code>any</code>, optional) ‚Äî Seed –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ–º, —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ –¥—Ä—É–≥–∏–º —Ç–∏–ø–æ–º)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>random_value</code></strong> (<code>integer</code>) ‚Äî Generated random number</li><li><strong><code>random_seed</code></strong> (<code>string</code>) (optional) ‚Äî –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π seed (–µ—Å–ª–∏ –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å)</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_int&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # seed: any (optional)</span></span></code></pre></div><p><a id="generate_unique_id"></a></p><h3 id="generate-unique-id" tabindex="-1">generate_unique_id <a class="header-anchor" href="#generate-unique-id" aria-label="Permalink to &quot;generate_unique_id&quot;">‚Äã</a></h3><p><strong>Description:</strong> Generate unique ID via DB autoincrement (deterministic; same seed = same ID). If no seed, random UUID</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>seed</code></strong> (<code>string</code>, optional, min length: 1) ‚Äî Seed –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ID. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å —Ç–µ–º –∂–µ seed –≤–µ—Ä–Ω–µ—Ç—Å—è —Ç–æ—Ç –∂–µ ID. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–π UUID</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>unique_id</code></strong> (<code>integer</code>) ‚Äî –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π, –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ç–æ—Ç –∂–µ ID)</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_unique_id&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # seed: string (optional)</span></span></code></pre></div><p><a id="modify_array"></a></p><h3 id="modify-array" tabindex="-1">modify_array <a class="header-anchor" href="#modify-array" aria-label="Permalink to &quot;modify_array&quot;">‚Äã</a></h3><p><strong>Description:</strong> Modify array: add, remove items or clear</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>operation</code></strong> (<code>string</code>, required, values: [<code>add</code>, <code>remove</code>, <code>clear</code>]) ‚Äî –û–ø–µ—Ä–∞—Ü–∏—è: &#39;add&#39; (–¥–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç), &#39;remove&#39; (—É–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç), &#39;clear&#39; (–æ—á–∏—Å—Ç–∏—Ç—å –º–∞—Å—Å–∏–≤)</li><li><strong><code>array</code></strong> (<code>array</code>) ‚Äî –ò—Å—Ö–æ–¥–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏</li><li><strong><code>value</code></strong> (<code>any</code>, optional) ‚Äî –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π &#39;add&#39; –∏ &#39;remove&#39;)</li><li><strong><code>skip_duplicates</code></strong> (<code>boolean</code>, optional) ‚Äî –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true - –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —É–∂–µ –µ—Å—Ç—å)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî –†–µ–∑—É–ª—å—Ç–∞—Ç: success (—É—Å–ø–µ—à–Ω–æ), not_found (—ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ remove), error (–æ—à–∏–±–∫–∞)</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>modified_array</code></strong> (<code>array</code>) ‚Äî –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;modify_array&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    operation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: []</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # value: any (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # skip_duplicates: boolean (optional)</span></span></code></pre></div><p><a id="set_cache"></a></p><h3 id="set-cache" tabindex="-1">set_cache <a class="header-anchor" href="#set-cache" aria-label="Permalink to &quot;set_cache&quot;">‚Äã</a></h3><p><strong>Description:</strong> Set temporary data in scenario cache. All params returned in response_data and go to flat _cache by default.</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>cache</code></strong> (<code>object</code>) ‚Äî –û–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –∫—ç—à. –í—Å–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è —á–µ—Ä–µ–∑ {_cache.–∫–ª—é—á} (–ø–ª–æ—Å–∫–∏–π –¥–æ—Å—Ç—É–ø –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî –í—Å–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –æ–±—ä–µ–∫—Ç–∞ cache –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ response_data –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ø–ª–æ—Å–∫–∏–π _cache –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. <ul><li><strong><code>*</code></strong> (<code>any</code>) ‚Äî –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–∏ –∏–∑ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ cache. –í—Å–µ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ {_cache.–∏–º—è_–∫–ª—é—á–∞} (–ø–ª–æ—Å–∫–∏–π –¥–æ—Å—Ç—É–ø –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;set_cache&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {}</span></span></code></pre></div><details><summary>üìñ Additional Information</summary><p><strong>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">step</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;set_cache&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        selected_user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@username&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        reason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;–°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          timestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2024-01-15&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ai_router&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;send_message&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {_cache.selected_user}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        –ü—Ä–∏—á–∏–Ω–∞: {_cache.reason}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        –í—Ä–µ–º—è: {_cache.metadata.timestamp}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        –ò—Å—Ç–æ—á–Ω–∏–∫: {_cache.metadata.source}</span></span></code></pre></div><p><strong>–í–∞–∂–Ω–æ:</strong></p><ul><li>–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ –∫–ª—é—á–µ <code>cache</code> –≤ params</li><li>–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å</li><li>–í–µ—Å—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è (user_id, chat_id, bot_id –∏ –¥—Ä.) –Ω–µ –ø–æ–ø–∞–¥–µ—Ç –≤ –∫—ç—à</li></ul><p><strong>–î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º:</strong></p><ul><li>–í—Å–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã <code>{_cache.–∫–ª—é—á}</code> (–ø–ª–æ—Å–∫–∏–π –¥–æ—Å—Ç—É–ø –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</li><li>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: <code>{_cache.metadata.timestamp}</code></li><li>–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è</li></ul></details><p><a id="sleep"></a></p><h3 id="sleep" tabindex="-1">sleep <a class="header-anchor" href="#sleep" aria-label="Permalink to &quot;sleep&quot;">‚Äã</a></h3><p><strong>Description:</strong> Delay execution for given seconds</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>seconds</code></strong> (<code>float</code>, required, min: 0.0) ‚Äî Seconds to delay (float allowed, e.g. 0.5, 22.5)</li></ul><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sleep&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    seconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span></span></code></pre></div><p><a id="scenario_processor"></a></p><h2 id="scenario-processor" tabindex="-1">scenario_processor <a class="header-anchor" href="#scenario-processor" aria-label="Permalink to &quot;scenario_processor&quot;">‚Äã</a></h2><p><strong>Description:</strong> Service for processing events by scenarios</p><p><a id="execute_scenario"></a></p><h3 id="execute-scenario" tabindex="-1">execute_scenario <a class="header-anchor" href="#execute-scenario" aria-label="Permalink to &quot;execute_scenario&quot;">‚Äã</a></h3><p><strong>Description:</strong> Execute scenario or array of scenarios by name</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>scenario</code></strong> (<code>string|array</code>) ‚Äî Scenario name (string) or array of scenario names</li><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID (passed from context)</li><li><strong><code>return_cache</code></strong> (<code>boolean</code>, optional) ‚Äî Return _cache from executed scenario (default true). Only for single scenario (string), ignored for array</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data with scenario execution result <ul><li><strong><code>scenario_result</code></strong> (<code>string</code>) ‚Äî Scenario result: success, error, abort, break, stop</li><li><strong><code>_cache</code></strong> (<code>object</code>) (optional) ‚Äî Cache from executed scenario (single scenario only, when return_cache=true). Data in _cache[action_name]</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;execute_scenario&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    scenario</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # return_cache: boolean (optional)</span></span></code></pre></div><p><a id="wait_for_action"></a></p><h3 id="wait-for-action" tabindex="-1">wait_for_action <a class="header-anchor" href="#wait-for-action" aria-label="Permalink to &quot;wait_for_action&quot;">‚Äã</a></h3><p><strong>Description:</strong> Wait for async action by action_id. Returns main action result AS IS</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>action_id</code></strong> (<code>string</code>, required, min length: 1) ‚Äî Unique async action ID to wait for</li><li><strong><code>timeout</code></strong> (<code>integer</code>, optional, min: 0.0) ‚Äî Wait timeout in seconds (optional). On timeout returns timeout error; scenario continues; async action keeps running in background.</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result from main action on success, or wait error (timeout/error) on wait failure</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data from main action on success; absent on wait error</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wait_for_action&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    action_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # timeout: integer (optional)</span></span></code></pre></div><p><a id="storage_hub"></a></p><h2 id="storage-hub" tabindex="-1">storage_hub <a class="header-anchor" href="#storage-hub" aria-label="Permalink to &quot;storage_hub&quot;">‚Äã</a></h2><p><strong>Description:</strong> Service for managing tenant storage</p><p><a id="delete_storage"></a></p><h3 id="delete-storage" tabindex="-1">delete_storage <a class="header-anchor" href="#delete-storage" aria-label="Permalink to &quot;delete_storage&quot;">‚Äã</a></h3><p><strong>Description:</strong> Delete values or groups from storage. If key or key_pattern set - delete value, else delete group</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID (required)</li><li><strong><code>group_key</code></strong> (<code>string</code>, optional) ‚Äî Group key (exact match, takes priority over group_key_pattern)</li><li><strong><code>group_key_pattern</code></strong> (<code>string</code>, optional, min length: 1) ‚Äî Pattern for group search (ILIKE, used when group_key not specified)</li><li><strong><code>key</code></strong> (<code>string</code>, optional) ‚Äî Attribute key (exact match). If set - delete value, else delete group</li><li><strong><code>key_pattern</code></strong> (<code>string</code>, optional, min length: 1) ‚Äî Pattern for key (ILIKE). If set - delete value, else delete group</li></ul><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error, not_found</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;delete_storage&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # group_key: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # group_key_pattern: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # key: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # key_pattern: string (optional)</span></span></code></pre></div><p><a id="get_storage"></a></p><h3 id="get-storage" tabindex="-1">get_storage <a class="header-anchor" href="#get-storage" aria-label="Permalink to &quot;get_storage&quot;">‚Äã</a></h3><p><strong>Description:</strong> Get storage values for tenant. Supports full values, group, single value, and pattern search</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID (required)</li><li><strong><code>group_key</code></strong> (<code>string</code>, optional) ‚Äî Group key (exact match, takes priority over group_key_pattern)</li><li><strong><code>group_key_pattern</code></strong> (<code>string</code>, optional, min length: 1) ‚Äî Pattern for group search (ILIKE, used when group_key not specified)</li><li><strong><code>key</code></strong> (<code>string</code>, optional) ‚Äî Attribute key (exact match, priority over key_pattern). Only when group_key or group_key_pattern specified</li><li><strong><code>key_pattern</code></strong> (<code>string</code>, optional, min length: 1) ‚Äî Pattern for key search (ILIKE, used when key not specified). Only when group_key or group_key_pattern specified</li><li><strong><code>format</code></strong> (<code>boolean</code>, optional) ‚Äî If true, returns additional formatted_text field with YAML data</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error, not_found</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>storage_values</code></strong> (<code>any</code>) ‚Äî Requested data. If group_key and key set - raw value. If only group_key - group structure {key: value}. If none - full structure {group_key: {key: value}}</li><li><strong><code>formatted_text</code></strong> (<code>string</code>) (optional) ‚Äî Formatted text in YAML (returned only when format=true)</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;get_storage&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # group_key: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # group_key_pattern: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # key: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # key_pattern: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # format: boolean (optional)</span></span></code></pre></div><p><a id="get_storage_groups"></a></p><h3 id="get-storage-groups" tabindex="-1">get_storage_groups <a class="header-anchor" href="#get-storage-groups" aria-label="Permalink to &quot;get_storage_groups&quot;">‚Äã</a></h3><p><strong>Description:</strong> Get list of unique group keys for tenant. Returns group_key list only (limited by storage_groups_max_limit)</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID (required)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>group_keys</code></strong> (<code>array (of string)</code>) ‚Äî List of unique group keys (limited by storage_groups_max_limit)</li><li><strong><code>is_truncated</code></strong> (<code>boolean</code>) (optional) ‚Äî Flag that list was truncated (true if more groups than limit)</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;get_storage_groups&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span></code></pre></div><p><a id="set_storage"></a></p><h3 id="set-storage" tabindex="-1">set_storage <a class="header-anchor" href="#set-storage" aria-label="Permalink to &quot;set_storage&quot;">‚Äã</a></h3><p><strong>Description:</strong> Set storage values for tenant. Supports full structure via values or partial via group_key/key/value</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID (required)</li><li><strong><code>group_key</code></strong> (<code>string</code>, optional) ‚Äî Group key (placeholder support). If set, mixed approach is used</li><li><strong><code>key</code></strong> (<code>string</code>, optional) ‚Äî Value key (placeholder support). Used with group_key</li><li><strong><code>value</code></strong> (<code>any</code>, optional) ‚Äî Value to set. Used with group_key and key</li><li><strong><code>values</code></strong> (<code>object</code>, optional) ‚Äî Structure to set. If group_key set - group {key: value}, else full {group_key: {key: value}}</li><li><strong><code>format</code></strong> (<code>boolean</code>, optional) ‚Äî If true, returns additional formatted_text field with YAML data</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>storage_values</code></strong> (<code>any</code>) ‚Äî Set data. Single value returns raw value; group returns {key: value}; full returns {group_key: {key: value}}</li><li><strong><code>formatted_text</code></strong> (<code>string</code>) (optional) ‚Äî Formatted text in YAML (returned only when format=true)</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;set_storage&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # group_key: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # key: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # value: any (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # values: object (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # format: boolean (optional)</span></span></code></pre></div><p><a id="telegram_bot_api"></a></p><h2 id="telegram-bot-api" tabindex="-1">telegram_bot_api <a class="header-anchor" href="#telegram-bot-api" aria-label="Permalink to &quot;telegram_bot_api&quot;">‚Äã</a></h2><p><strong>Description:</strong> Service for executing actions via Telegram Bot API</p><p><a id="answer_callback_query"></a></p><h3 id="answer-callback-query" tabindex="-1">answer_callback_query <a class="header-anchor" href="#answer-callback-query" aria-label="Permalink to &quot;answer_callback_query&quot;">‚Äã</a></h3><p><strong>Description:</strong> Answer callback query (popup notification)</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>bot_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Bot ID</li><li><strong><code>callback_query_id</code></strong> (<code>string</code>, required, min length: 1) ‚Äî Callback query ID from Telegram</li><li><strong><code>text</code></strong> (<code>string</code>, optional, max length: 200) ‚Äî Notification text</li><li><strong><code>show_alert</code></strong> (<code>boolean</code>, optional) ‚Äî Show as alert instead of notification</li><li><strong><code>cache_time</code></strong> (<code>integer</code>, optional, range: 0-3600) ‚Äî Answer cache time (seconds)</li></ul><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;answer_callback_query&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    bot_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    callback_query_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # text: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # show_alert: boolean (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # cache_time: integer (optional)</span></span></code></pre></div><p><a id="build_keyboard"></a></p><h3 id="build-keyboard" tabindex="-1">build_keyboard <a class="header-anchor" href="#build-keyboard" aria-label="Permalink to &quot;build_keyboard&quot;">‚Äã</a></h3><p><strong>Description:</strong> Build keyboard from ID array using templates</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>items</code></strong> (<code>array</code>) ‚Äî Array of IDs for button generation</li><li><strong><code>keyboard_type</code></strong> (<code>string</code>, required, values: [<code>inline</code>, <code>reply</code>]) ‚Äî Keyboard type (inline or reply)</li><li><strong><code>text_template</code></strong> (<code>string</code>, required, min length: 1) ‚Äî Text template with $value$ placeholder</li><li><strong><code>callback_template</code></strong> (<code>string</code>, optional, min length: 1) ‚Äî Callback data template for inline (required for inline)</li><li><strong><code>buttons_per_row</code></strong> (<code>integer</code>, optional, range: 1-8) ‚Äî Buttons per row</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Build result</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Keyboard data <ul><li><strong><code>keyboard</code></strong> (<code>array</code>) ‚Äî Array of button rows</li><li><strong><code>keyboard_type</code></strong> (<code>string</code>) ‚Äî Keyboard type</li><li><strong><code>rows_count</code></strong> (<code>integer</code>) ‚Äî Number of rows</li><li><strong><code>buttons_count</code></strong> (<code>integer</code>) ‚Äî Number of buttons</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;build_keyboard&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    items</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: []</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    keyboard_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    text_template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # callback_template: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # buttons_per_row: integer (optional)</span></span></code></pre></div><p><a id="delete_message"></a></p><h3 id="delete-message" tabindex="-1">delete_message <a class="header-anchor" href="#delete-message" aria-label="Permalink to &quot;delete_message&quot;">‚Äã</a></h3><p><strong>Description:</strong> Delete message by bot</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>bot_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Bot ID</li><li><strong><code>delete_message_id</code></strong> (<code>integer</code>, optional, min: 1) ‚Äî Message ID to delete</li></ul><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Delete result</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;delete_message&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    bot_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # delete_message_id: integer (optional)</span></span></code></pre></div><p><a id="restrict_chat_member"></a></p><h3 id="restrict-chat-member" tabindex="-1">restrict_chat_member <a class="header-anchor" href="#restrict-chat-member" aria-label="Permalink to &quot;restrict_chat_member&quot;">‚Äã</a></h3><p><strong>Description:</strong> Restrict a user in a supergroup (permission groups: messages, attachments, other, management)</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>bot_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Bot ID</li><li><strong><code>chat_id</code></strong> (<code>integer|string</code>) ‚Äî Chat ID (supergroup)</li><li><strong><code>target_user_id</code></strong> (<code>integer</code>) ‚Äî User ID to restrict (target; does not conflict with context user_id)</li><li><strong><code>messages</code></strong> (<code>boolean</code>, optional) ‚Äî Allow text messages, contacts, locations, etc. If omitted ‚Äî not sent to API</li><li><strong><code>attachments</code></strong> (<code>boolean</code>, optional) ‚Äî Allow audio, documents, photos, videos, video notes, voice. If omitted ‚Äî not sent to API</li><li><strong><code>other</code></strong> (<code>boolean</code>, optional) ‚Äî Allow polls, stickers, games, inline, link previews. If omitted ‚Äî not sent to API</li><li><strong><code>management</code></strong> (<code>boolean</code>, optional) ‚Äî Allow change info, invite users, pin messages, manage topics. If omitted ‚Äî not sent to API</li><li><strong><code>until_date</code></strong> (<code>integer</code>, optional, min: 0) ‚Äî Unix time when restrictions are lifted; 0 or omit ‚Äî forever</li></ul><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;restrict_chat_member&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    bot_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    chat_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    target_user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # messages: boolean (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # attachments: boolean (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # other: boolean (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # management: boolean (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # until_date: integer (optional)</span></span></code></pre></div><p><a id="send_message"></a></p><h3 id="send-message" tabindex="-1">send_message <a class="header-anchor" href="#send-message" aria-label="Permalink to &quot;send_message&quot;">‚Äã</a></h3><p><strong>Description:</strong> Send message by bot</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>bot_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Bot ID</li><li><strong><code>target_chat_id</code></strong> (<code>integer|array|string</code>, optional) ‚Äî Chat ID or array of chat IDs</li><li><strong><code>text</code></strong> (<code>string</code>, optional) ‚Äî Message text</li><li><strong><code>parse_mode</code></strong> (<code>string</code>, optional, values: [<code>HTML</code>, <code>Markdown</code>, <code>MarkdownV2</code>]) ‚Äî Parse mode (HTML, Markdown, MarkdownV2)</li><li><strong><code>message_edit</code></strong> (<code>integer|boolean|string</code>, optional) ‚Äî Message ID to edit or flag</li><li><strong><code>message_reply</code></strong> (<code>integer|boolean|string</code>, optional) ‚Äî Reply to message: true (reply to current event message), integer/string (message ID)</li><li><strong><code>inline</code></strong> (<code>array</code>, optional) ‚Äî Inline keyboard</li><li><strong><code>reply</code></strong> (<code>array</code>, optional) ‚Äî Reply keyboard</li><li><strong><code>attachment</code></strong> (<code>array</code>, optional) ‚Äî Attachments</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Send result</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li><strong><code>last_message_id</code></strong> (<code>integer</code>) ‚Äî Sent message ID</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;send_message&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    bot_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # target_chat_id: integer|array|string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # text: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # parse_mode: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # message_edit: integer|boolean|string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # message_reply: integer|boolean|string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # inline: array (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # reply: array (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # attachment: array (optional)</span></span></code></pre></div><p><a id="user_hub"></a></p><h2 id="user-hub" tabindex="-1">user_hub <a class="header-anchor" href="#user-hub" aria-label="Permalink to &quot;user_hub&quot;">‚Äã</a></h2><p><strong>Description:</strong> Central service for managing user states</p><p><a id="clear_user_state"></a></p><h3 id="clear-user-state" tabindex="-1">clear_user_state <a class="header-anchor" href="#clear-user-state" aria-label="Permalink to &quot;clear_user_state&quot;">‚Äã</a></h3><p><strong>Description:</strong> Clear user state</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>user_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Telegram user ID</li><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID</li></ul><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;clear_user_state&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span></code></pre></div><p><a id="delete_user_storage"></a></p><h3 id="delete-user-storage" tabindex="-1">delete_user_storage <a class="header-anchor" href="#delete-user-storage" aria-label="Permalink to &quot;delete_user_storage&quot;">‚Äã</a></h3><p><strong>Description:</strong> Delete values from user storage</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID</li><li><strong><code>user_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Telegram user ID</li><li><strong><code>key</code></strong> (<code>string</code>, optional) ‚Äî Key to delete (exact). If key and key_pattern both unset - delete all user records</li><li><strong><code>key_pattern</code></strong> (<code>string</code>, optional, min length: 1) ‚Äî Pattern for keys to delete (ILIKE). If both unset - delete all</li></ul><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error, not_found</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details (e.g. field validation errors)</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;delete_user_storage&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # key: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # key_pattern: string (optional)</span></span></code></pre></div><p><a id="get_tenant_users"></a></p><h3 id="get-tenant-users" tabindex="-1">get_tenant_users <a class="header-anchor" href="#get-tenant-users" aria-label="Permalink to &quot;get_tenant_users&quot;">‚Äã</a></h3><p><strong>Description:</strong> Get list of all user_id for tenant</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>) ‚Äî Tenant ID</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>user_ids</code></strong> (<code>array (of integer)</code>) ‚Äî Array of Telegram user IDs</li><li><strong><code>user_count</code></strong> (<code>integer</code>) ‚Äî Number of users</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;get_tenant_users&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span></code></pre></div><p><a id="get_user_state"></a></p><h3 id="get-user-state" tabindex="-1">get_user_state <a class="header-anchor" href="#get-user-state" aria-label="Permalink to &quot;get_user_state&quot;">‚Äã</a></h3><p><strong>Description:</strong> Get user state with expiry check</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>user_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Telegram user ID</li><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li>üîÄ <strong><code>user_state</code></strong> (<code>string</code>) (optional) ‚Äî User state or None if expired/not set</li><li><strong><code>user_state_expired_at</code></strong> (<code>string</code>) (optional) ‚Äî State expiry time (ISO) or None if not set</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;get_user_state&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span></code></pre></div><p><a id="get_user_storage"></a></p><h3 id="get-user-storage" tabindex="-1">get_user_storage <a class="header-anchor" href="#get-user-storage" aria-label="Permalink to &quot;get_user_storage&quot;">‚Äã</a></h3><p><strong>Description:</strong> Get user storage values. Supports full values, single key, or key_pattern search</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID</li><li><strong><code>user_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Telegram user ID</li><li><strong><code>key</code></strong> (<code>string</code>, optional) ‚Äî Key for single value (exact match, priority over key_pattern)</li><li><strong><code>key_pattern</code></strong> (<code>string</code>, optional, min length: 1) ‚Äî Pattern for key search (ILIKE, used when key not set)</li><li><strong><code>format</code></strong> (<code>boolean</code>, optional) ‚Äî If true, returns formatted_text with YAML data</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p>`,449),s("ul",null,[s("li",null,[s("strong",null,[s("code",null,"result")]),e(" ("),s("code",null,"string"),e(") ‚Äî Result: success, error, not_found")]),s("li",null,[s("strong",null,[s("code",null,"error")]),e(" ("),s("code",null,"object"),e(") (optional) ‚Äî Error structure "),s("ul",null,[s("li",null,[s("strong",null,[s("code",null,"code")]),e(" ("),s("code",null,"string"),e(") ‚Äî Error code")]),s("li",null,[s("strong",null,[s("code",null,"message")]),e(" ("),s("code",null,"string"),e(") ‚Äî Error message")]),s("li",null,[s("strong",null,[s("code",null,"details")]),e(" ("),s("code",null,"array"),e(") (optional) ‚Äî Error details")])])]),s("li",null,[s("strong",null,[s("code",null,"response_data")]),e(" ("),s("code",null,"object"),e(") ‚Äî "),s("ul",null,[s("li",{"key:":"",value:""},[e("üîÄ "),s("strong",null,[s("code",null,"user_storage_values")]),e(" ("),s("code",null,"any"),e(") ‚Äî Requested data. If key set - raw value. If none - full")]),s("li",null,[s("strong",null,[s("code",null,"formatted_text")]),e(" ("),s("code",null,"string"),e(") (optional) ‚Äî Formatted YAML text (only when format=true)")])])])],-1),a(`<p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;get_user_storage&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # key: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # key_pattern: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # format: boolean (optional)</span></span></code></pre></div><p><a id="get_users_by_storage_value"></a></p><h3 id="get-users-by-storage-value" tabindex="-1">get_users_by_storage_value <a class="header-anchor" href="#get-users-by-storage-value" aria-label="Permalink to &quot;get_users_by_storage_value&quot;">‚Äã</a></h3><p><strong>Description:</strong> Find users by storage key and value (e.g. users with subscription)</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID</li><li><strong><code>key</code></strong> (<code>string</code>, required, min length: 1) ‚Äî Storage key to search</li><li><strong><code>value</code></strong> (<code>string|integer|float|boolean|array|object</code>) ‚Äî Value to search (primitive or JSON object)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>user_ids</code></strong> (<code>array (of integer)</code>) ‚Äî Array of Telegram user IDs where storage[key] == value</li><li><strong><code>user_count</code></strong> (<code>integer</code>) ‚Äî Number of users found</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;get_users_by_storage_value&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span></span></code></pre></div><p><a id="set_user_state"></a></p><h3 id="set-user-state" tabindex="-1">set_user_state <a class="header-anchor" href="#set-user-state" aria-label="Permalink to &quot;set_user_state&quot;">‚Äã</a></h3><p><strong>Description:</strong> Set user state</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>user_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Telegram user ID</li><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID</li><li><strong><code>state</code></strong> (<code>string</code>, optional) ‚Äî User state (None or empty to clear)</li><li><strong><code>expires_in_seconds</code></strong> (<code>integer</code>, optional, min: 0) ‚Äî Expiry in seconds (None or 0 = forever)</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî Response data <ul><li><strong><code>user_state</code></strong> (<code>string</code>) (optional) ‚Äî User state or None if expired/not set</li><li><strong><code>user_state_expired_at</code></strong> (<code>string</code>) (optional) ‚Äî State expiry time (ISO) or None if not set</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;set_user_state&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # state: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # expires_in_seconds: integer (optional)</span></span></code></pre></div><p><a id="set_user_storage"></a></p><h3 id="set-user-storage" tabindex="-1">set_user_storage <a class="header-anchor" href="#set-user-storage" aria-label="Permalink to &quot;set_user_storage&quot;">‚Äã</a></h3><p><strong>Description:</strong> Set user storage. Full structure via values or partial via key/value</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>tenant_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Tenant ID</li><li><strong><code>user_id</code></strong> (<code>integer</code>, required, min: 1) ‚Äî Telegram user ID</li><li><strong><code>key</code></strong> (<code>string</code>, optional) ‚Äî Value key (placeholder support). If set, mixed approach</li><li><strong><code>value</code></strong> (<code>any</code>, optional) ‚Äî Value to set. Used with key</li><li><strong><code>values</code></strong> (<code>object</code>, optional) ‚Äî Full structure to set {key: value}. Only when key not set</li><li><strong><code>format</code></strong> (<code>boolean</code>, optional) ‚Äî If true, returns formatted_text with YAML data</li></ul><details><summary>‚öôÔ∏è Additional Parameters</summary><ul><li><p><strong><code>_namespace</code></strong> (<code>string</code>) (optional) ‚Äî Custom key for creating nesting in <code>_cache</code>. If specified, data is saved in <code>_cache[_namespace]</code> instead of flat cache. Used to control overwriting on repeated calls of the same action. Access via <code>{_cache._namespace.field}</code>. By default, data is merged directly into <code>_cache</code> (flat caching).</p></li><li><p><strong><code>_response_key</code></strong> (<code>string</code>) (optional) ‚Äî Custom name for main result field (marked üîÄ). If specified, main field will be saved in <code>_cache</code> under specified name instead of standard. Access via <code>{_cache.{_response_key}}</code>. Works only for actions that support renaming main field.</p></li></ul></details><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li><li><strong><code>response_data</code></strong> (<code>object</code>) ‚Äî <ul><li>üîÄ <strong><code>user_storage_values</code></strong> (<code>any</code>) ‚Äî Set data. Single value or full {key: value} structure</li><li><strong><code>formatted_text</code></strong> (<code>string</code>) (optional) ‚Äî Formatted YAML text (only when format=true)</li></ul></li></ul><p><strong>Note:</strong></p><ul><li>üîÄ ‚Äî field that can be renamed via <code>_response_key</code> parameter for convenient data access</li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;set_user_storage&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tenant_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # key: string (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # value: any (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # values: object (optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # format: boolean (optional)</span></span></code></pre></div><p><a id="validator"></a></p><h2 id="validator" tabindex="-1">validator <a class="header-anchor" href="#validator" aria-label="Permalink to &quot;validator&quot;">‚Äã</a></h2><p><strong>Description:</strong> Service for validating conditions in scenarios</p><p><a id="validate"></a></p><h3 id="validate" tabindex="-1">validate <a class="header-anchor" href="#validate" aria-label="Permalink to &quot;validate&quot;">‚Äã</a></h3><p><strong>Description:</strong> Validate condition and return result</p><p><strong>Input Parameters:</strong></p><ul><li><strong><code>condition</code></strong> (<code>string</code>, required, min length: 1) ‚Äî Condition to validate (supports all condition_parser operators)</li></ul><p><strong>Output Parameters:</strong></p><ul><li><strong><code>result</code></strong> (<code>string</code>) ‚Äî Result: success, failed, error</li><li><strong><code>error</code></strong> (<code>object</code>) (optional) ‚Äî Error structure <ul><li><strong><code>code</code></strong> (<code>string</code>) ‚Äî Error code</li><li><strong><code>message</code></strong> (<code>string</code>) ‚Äî Error message</li><li><strong><code>details</code></strong> (<code>array</code>) (optional) ‚Äî Error details</li></ul></li></ul><p><strong>Usage Example:</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In scenario</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;validate&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    condition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span></span></code></pre></div><details><summary>üìñ Additional Information</summary><p>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã: <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>in</code>, <code>not in</code>, <code>~</code>, <code>!~</code>, <code>regex</code>, <code>is_null</code>, <code>not is_null</code></p><p><strong>–ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã:</strong></p><ul><li>‚úÖ <code>condition: &quot;{_cache.storage_values.tenant_owner|exists} == True and {_cache.storage_values.tenant_owner|length} &gt; 0&quot;</code></li><li>‚úÖ <code>condition: &quot;{_cache.storage_values.tenant_id} == 137&quot;</code></li><li>‚úÖ <code>condition: &quot;{_cache.storage_values.tenant_id} &gt; 100&quot;</code></li></ul><p><strong>–ú–∞—Ä–∫–µ—Ä—ã:</strong></p><ul><li>‚úÖ <code>condition: &quot;$user_id &gt; 100&quot;</code></li><li>‚úÖ <code>condition: &quot;$_cache.storage_values.tenant_owner not is_null&quot;</code></li><li>‚úÖ <code>condition: &quot;$event_type == &#39;message&#39; and $user_id &gt; 100&quot;</code></li></ul></details>`,51)])])}const m=t(l,[["render",r]]);export{u as __pageData,m as default};
